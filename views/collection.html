<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Коллекция · Higher Waist

    </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-container">
            <div class="header-left">
                <button class="menu-btn" id="mobileMenuBtn" aria-label="Меню">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <a href="/" class="logo">
                <span class="logo-text">Higher Waist

                </span>
                <span class="logo-dot">·</span>
            </a>

            <div class="header-right">
                <button class="icon-btn search-btn" id="searchBtn" aria-label="Поиск">
                    <i class="fas fa-search"></i>
                </button>
                <button class="icon-btn wishlist-btn" id="wishlistBtn" aria-label="Избранное">
                    <i class="far fa-heart"></i>
                    <span class="badge" id="wishlistBadge">0</span>
                </button>
                <button class="icon-btn cart-btn" id="cartBtn" aria-label="Корзина">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="badge" id="cartBadge">0</span>
                </button>
            </div>
        </div>

        <nav class="nav" id="mainNav">
            <div class="container">
                <ul class="nav-list">
                    <li><a href="/catalog?category=all" class="nav-link">Все товары</a></li>
                    <li><a href="/catalog?tag=Sale" class="nav-link nav-link-sale">Sale</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Search Modal -->
    <div class="modal" id="searchModal">
        <div class="modal-overlay" id="searchModalOverlay"></div>
        <div class="modal-content search-modal-content">
            <button class="modal-close" id="searchModalClose" aria-label="Закрыть">
                <i class="fas fa-times"></i>
            </button>
            <div class="search-modal-body">
                <input type="text" class="search-input-large" id="searchInput" placeholder="Поиск товаров...">
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
    </div>

    <!-- Collection Page -->
    <div class="catalog-page">
        <div class="container">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs" aria-label="breadcrumb">
                <a href="/">Главная</a>
                <span>/</span>
                <a href="/catalog">Каталог</a>
                <span>/</span>
                <span id="breadcrumbCurrent">Коллекция</span>
            </nav>

            <!-- Collection Header -->
            <div class="collection-header">
                <h1 class="page-title" id="collectionTitle">Загрузка...</h1>
                <p class="collection-description" id="collectionDescription"></p>
            </div>

            <!-- Collection page banner (admin placement: collection_page) -->
            <section class="collection-banner" style="display:none;"></section>

            <!-- Products Grid -->
            <div class="products-section">
                <div class="products-count" id="productsCount">
                    <span id="productsTotal">0</span> товаров
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="loadingState">
                    <div class="loading-spinner"></div>
                    <p>Загрузка товаров...</p>
                </div>

                <!-- Error State -->
                <div class="error-state" id="errorState" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Коллекция не найдена</h3>
                    <p>Эта коллекция больше не доступна или была удалена.</p>
                    <a href="/catalog" class="btn btn-primary">Перейти в каталог</a>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-box-open"></i>
                    <h3>В коллекции пока нет товаров</h3>
                    <p>Скоро здесь появятся новые товары. Следите за обновлениями!</p>
                    <a href="/catalog" class="btn btn-primary">Перейти в каталог</a>
                </div>

                <!-- Products Grid -->
                <div class="products-grid products-grid-3" id="productsGrid"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="logo footer-logo">
                        <span class="logo-text">Higher Waist

                        </span>
                        <span class="logo-dot">·</span>
                    </div>
                    <p class="footer-text">Минималистичная мода для современной жизни</p>
                    <div class="social-links">
                        <a href="#" class="social-link" data-social="instagram" aria-label="Instagram"><i
                                class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link" data-social="facebook" aria-label="Facebook"><i
                                class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-link" data-social="telegram" aria-label="Telegram"><i
                                class="fab fa-telegram"></i></a>
                        <a href="#" class="social-link" data-social="tiktok" aria-label="TikTok"><i
                                class="fab fa-tiktok"></i></a>
                        <a href="#" class="social-link" data-social="youtube" aria-label="YouTube"><i
                                class="fab fa-youtube"></i></a>
                        <a href="#" class="social-link" data-social="whatsapp" aria-label="WhatsApp"><i
                                class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Покупателям</h4>
                    <ul class="footer-links">
                        <li><a href="/delivery">Доставка</a></li>
                        <li><a href="/payment">Оплата</a></li>
                        <li><a href="/returns">Возврат и обмен</a></li>
                        <li><a href="/faq">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">О компании</h4>
                    <ul class="footer-links">
                        <li><a href="/about">О нас</a></li>
                        <li><a href="/contacts">Контакты</a></li>
                        <li><a href="/terms">Публичная оферта</a></li>
                        <li><a href="/privacy">Политика конфиденциальности</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Контакты</h4>
                    <ul class="footer-contacts">
                        <li><i class="fas fa-phone"></i> <a id="contactPhone" href="tel:">—</a></li>
                        <li><i class="fas fa-envelope"></i> <a id="contactEmail" href="mailto:">—</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Помощь</h4>
                    <ul class="footer-links">
                        <li><a href="/faq">Частые вопросы</a></li>
                        <li><a href="/delivery">Сроки доставки</a></li>
                        <li><a href="/returns">Как оформить возврат</a></li>
                        <li><a href="/contacts">Связаться с нами</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Higher Waist

                    . Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script src="/js/api.js"></script>
    <script src="/js/banners-loader.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/app.js"></script>
    <script>
        // Get collection slug from URL
        const urlParams = new URLSearchParams(window.location.search);
        const collectionSlug = urlParams.get('slug');

        let currentCollection = null;
        let products = [];

        // DOM Elements
        const collectionTitle = document.getElementById('collectionTitle');
        const collectionDescription = document.getElementById('collectionDescription');
        const breadcrumbCurrent = document.getElementById('breadcrumbCurrent');
        const productsGrid = document.getElementById('productsGrid');
        const productsTotal = document.getElementById('productsTotal');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const emptyState = document.getElementById('emptyState');

        // Load collection
        async function loadCollection() {
            if (!collectionSlug) {
                showError();
                return;
            }

            try {
                loadingState.style.display = 'block';
                errorState.style.display = 'none';
                emptyState.style.display = 'none';
                productsGrid.innerHTML = '';

                // Load banners for collection page
                if (typeof loadBanners === 'function') {
                    await loadBanners();
                    if (typeof renderCollectionBanner === 'function') renderCollectionBanner();
                }

                // Fetch collection with products
                const response = await fetch(`/api/collections/slug/${collectionSlug}`);

                if (!response.ok) {
                    throw new Error('Collection not found');
                }

                const data = await response.json();
                currentCollection = data;
                products = data.products || [];

                // Update page title and meta
                const collectionName = currentCollection?.name || currentCollection?.title || 'Коллекция';
                document.title = `${collectionName} · Higher Waist

`;
                collectionTitle.textContent = collectionName;
                breadcrumbCurrent.textContent = collectionName;

                // Show description if available
                if (currentCollection.description) {
                    collectionDescription.textContent = currentCollection.description;
                    collectionDescription.style.display = 'block';
                } else {
                    collectionDescription.style.display = 'none';
                }

                loadingState.style.display = 'none';

                // Check if collection has products
                if (products.length === 0) {
                    showEmpty();
                    return;
                }

                // Display products
                productsTotal.textContent = products.length;
                renderProducts(products, 'productsGrid');

            } catch (error) {
                console.error('Error loading collection:', error);
                loadingState.style.display = 'none';
                showError();
            }
        }


        // Show error state
        function showError() {
            loadingState.style.display = 'none';
            errorState.style.display = 'block';
            emptyState.style.display = 'none';
            productsGrid.innerHTML = '';
            collectionTitle.textContent = 'Коллекция не найдена';
        }

        // Show empty state
        function showEmpty() {
            loadingState.style.display = 'none';
            errorState.style.display = 'none';
            emptyState.style.display = 'block';
            productsGrid.innerHTML = '';
        }


        async function applyStoreSettings() {
            try {
                const response = await fetch('/api/settings');
                if (!response.ok) return;
                const settings = await response.json();

                const logoText = settings.logo_text || settings.site_name || 'Higher Waist';
                document.querySelectorAll('.logo-text').forEach((el) => {
                    el.textContent = logoText;
                });

                const contactPhone = document.getElementById('contactPhone');
                if (contactPhone) {
                    const phone = settings.contact_phone || '';
                    contactPhone.textContent = phone || '—';
                    if (phone) {
                        contactPhone.href = `tel:${phone.replace(/\s+/g, '')}`;
                    } else {
                        contactPhone.removeAttribute('href');
                    }
                }

                const contactEmail = document.getElementById('contactEmail');
                if (contactEmail) {
                    const email = settings.contact_email || '';
                    contactEmail.textContent = email || '—';
                    if (email) {
                        contactEmail.href = `mailto:${email}`;
                    } else {
                        contactEmail.removeAttribute('href');
                    }
                }

                const footerName = settings.site_name || settings.logo_text || 'Higher Waist';
                const year = new Date().getFullYear();
                document.querySelectorAll('.footer-bottom p, .footer-copyright').forEach((el) => {
                    if (el.textContent) {
                        el.textContent = `© ${year} ${footerName}. Все права защищены.`;
                    }
                });
            } catch (error) {
                console.error('Failed to load store settings:', error);
            }
        }

        // Initialize
        applyStoreSettings();
        loadNavbarCategories();
        loadCollection();
        updateCartBadge();
        updateWishlistBadge();
    </script>
</body>

</html>